{% extends 'base.html.twig' %}

{% block title %}Paiement du trajet – EcoRide{% endblock %}

{% block body %}
<section class="hero-section bg-ecoride-primary text-white py-5">
    <div class="container text-center">
        <h2 class="hero-title">Paiement</h2>
        <h4 class="hero-tagline">
            Finalise ta réservation
        </h4>
    </div>
</section>

<section class="mb-5 bg-ecoride-light">
    <div class="container">
        <div class="row justify-content-center">

            <div class="col-md-8 col-lg-6">
                <div class="ecoride-form bg-white shadow p-4 rounded-4">

                    <h3 class="fw-bold text-success mb-3 text-center">
                        {{ trajet.villeDepart }} → {{ trajet.villeArrivee }}
                    </h3>

                    <p class="text-center text-muted mb-4">
                        Départ le {{ trajet.dateDepart|date('d/m/Y à H:i') }}
                    </p>

                    {% set platformFee = 2 %}
                    {% set totalTokens = trajet.tokenCost + platformFee %}

                    <div class="alert alert-info text-center">
                        Coût du trajet :
                        <strong>{{ trajet.tokenCost }} tokens</strong><br>
                        Frais plateforme :
                        <strong>{{ platformFee }} tokens</strong>
                    </div>

                    <form method="post"
                          action="{{ path('trajet_payment_validate', { id: trajet.id }) }}">

                        <input type="hidden"
                               name="_token"
                               value="{{ csrf_token('payment_trajet_' ~ trajet.id) }}">

                        <p class="fw-semibold text-center mt-3">
                            Paiement en monnaie interne EcoRide
                        </p>

                        <ul class="list-group mb-3">
                            <li class="list-group-item d-flex justify-content-between">
                                <span>Ton solde actuel</span>
                                <strong>{{ app.user.tokens }} tokens</strong>
                            </li>

                            <li class="list-group-item d-flex justify-content-between">
                                <span>Solde après réservation</span>
                                <strong>{{ app.user.tokens - totalTokens }} tokens</strong>
                            </li>
                        </ul>

                        <div class="alert alert-warning small text-center">
                            En confirmant, <strong>{{ totalTokens }} tokens</strong>
                            seront débités de ton compte EcoRide
                            ({{ trajet.tokenCost }} trajet + {{ platformFee }} frais plateforme).
                        </div>

                        <button type="submit"
                                class="btn btn-ecoride w-100 py-2 fw-semibold rounded-pill">
                            ✔ Confirmer et débiter {{ totalTokens }} tokens
                        </button>

                    </form>

                </div>
            </div>

        </div>
    </div>
</section>
{% endblock %}
