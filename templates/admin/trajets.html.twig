{% extends 'admin/_layout.html.twig' %}

{% block admin_content %}

<h2 class="text-success mb-4 fw-bold">
  Gestion des trajets
</h2>

{# ============================
   FILTRES
============================ #}
<div class="admin-trajet-show card p-4 shadow-sm rounded-4 mb-4">
  <form method="get" class="d-flex gap-3">

    <input type="text"
       name="depart"
       class="form-control rounded-pill bg-white"
       placeholder="Ville départ"
       value="{{ app.request.get('depart') }}">

    <input type="text"
       name="arrivee"
       class="form-control rounded-pill bg-white"
       placeholder="Ville arrivée"
       value="{{ app.request.get('arrivee') }}">

    <input type="text"
       name="conducteur"
       class="form-control rounded-pill bg-white"
       placeholder="Conducteur (prénom)"
       value="{{ app.request.get('conducteur') }}">

    <button class="btn btn-ecoride rounded-pill">
      Filtrer
    </button>

  </form>
</div>

{# ============================
   INFO "TODAY"
============================ #}
{% if app.request.get('date') == 'today' %}
  <div class="alert alert-info text-center rounded-pill">
    Affichage des trajets du jour
    <a href="{{ path('admin_trajets_index') }}" class="ms-2 fw-semibold">
      Réinitialiser
    </a>
  </div>
{% endif %}

{# ============================
   TABLE DES TRAJETS
============================ #}
<div class="card shadow-sm rounded-4 overflow-hidden">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-success ">
        <tr>
          <th>{{ knp_pagination_sortable(trajets, 'ID', 't.id') }}</th>
          <th>{{ knp_pagination_sortable(trajets, 'Départ', 't.villeDepart') }}</th>
          <th>{{ knp_pagination_sortable(trajets, 'Arrivée', 't.villeArrivee') }}</th>
          <th>{{ knp_pagination_sortable(trajets, 'Date', 't.dateDepart') }}</th>
          <th>{{ knp_pagination_sortable(trajets, 'Conducteur', 'u.prenom') }}</th>
          <th class="text-end">Actions</th>
        </tr>
      </thead>

      <tbody>
      {% for trajet in trajets %}
        <tr class="position-relative">
          <td class="fw-semibold">{{ trajet.id }}</td>
          <td>{{ trajet.villeDepart }}</td>
          <td>{{ trajet.villeArrivee }}</td>
          <td>{{ trajet.dateDepart|date('d/m/Y H:i') }}</td>
          <td>{{ trajet.conducteur ? trajet.conducteur.prenom : '—' }}</td>

          {# LIGNE CLIQUABLE -> show admin #}
          
            <td class="text-end color-success fw-semibold">
            <a href="{{ path('admin_trajet_show', { id: trajet.id }) }}" class="text-success">
            Détails
            </a>

            {# stretched-link: clique n'importe où sur la ligne (hors boutons) #}
            <a href="{{ path('admin_trajet_show', { id: trajet.id }) }}"
               class="stretched-link"
               aria-label="Ouvrir le trajet {{ trajet.id }}"></a>
          </td>
        </tr>
      {% else %}
        <tr>
          <td colspan="6" class="text-center text-muted py-4">
            Aucun trajet trouvé.
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
</div>

{# ============================
   PAGINATION
============================ #}
<div class="d-flex justify-content-center mt-4">
  {{ knp_pagination_render(trajets) }}
</div>

{% endblock %}
