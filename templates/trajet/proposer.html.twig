{# templates/trajet/proposer.html.twig #}
{% extends 'base.html.twig' %}

{% block title %}Proposer un trajet - EcoRide{% endblock %}

{% block body %}

<section class="hero-global hero-proposer d-flex align-items-center text-center text-white position-relative">
  <div class="container">
    <h1 class="hero-title mb-3 text-white">Proposer un trajet</h1>
    <h2 class="hero-tagline mb-4 text-white">Partage ta route, r√©duis ton empreinte</h2>
  </div>
</section>

<section class="proposer-section py-5 bg-light">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-9 col-lg-7">

        <div class="card ecoride-form shadow p-4 rounded-4">

          <div class="text-center mb-4">
            <h2 class="fw-bold text-success">Cr√©er ton trajet</h2>
            <p class="text-muted mb-0">Indique les d√©tails de ton voyage.</p>
          </div>

          {{ form_start(form, {
            action: path('app_proposer_trajet'),
            method: 'POST',
            attr: { novalidate: 'novalidate' }
          }) }}

          <div class="row g-3">

            <div class="col-md-6">
              {{ form_row(form.villeDepart) }}
            </div>

            <div class="col-md-6">
              {{ form_row(form.villeArrivee) }}
            </div>

            <div class="col-12">
              {{ form_row(form.dateDepart) }}
            </div>

            {# -------- VEHICULE -------- #}
            <div class="col-12">
              <h5 class="fw-semibold text-success mb-2">V√©hicule</h5>

              {{ form_row(form.vehicle) }}

              <button class="btn btn-outline-success btn-sm mt-2"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#collapseNewVehicle"
                      aria-expanded="false"
                      aria-controls="collapseNewVehicle"
                      id="btnNewVehicle">
                + Ajouter un nouveau v√©hicule
              </button>

              <div class="collapse mt-3" id="collapseNewVehicle">
                <div class="border rounded-4 p-4 bg-white">

                  <h6 class="fw-bold text-success mb-3">Nouveau v√©hicule</h6>

                  <div class="row g-3">

                    <div class="col-md-6">
                      <div class="autocomplete-wrapper position-relative">
                        {{ form_row(form.newVehicle.marque, {
                          attr: {
                            'data-vehicle-brand': true,
                            'autocomplete': 'off'
                          }
                        }) }}
                        <div class="autocomplete-list" data-brand-results></div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      <div class="autocomplete-wrapper position-relative">
                        {{ form_row(form.newVehicle.modele, {
                          attr: {
                            'data-vehicle-model': true,
                            'autocomplete': 'off'
                          }
                        }) }}
                        <div class="autocomplete-list" data-model-results></div>
                      </div>
                    </div>

                    <div class="col-md-6">
                      {{ form_row(form.newVehicle.immatriculation) }}
                    </div>

                    <div class="col-md-6">
                      {{ form_row(form.newVehicle.energie, { attr: { 'data-vehicle-energy': true } }) }}
                    </div>

                    <div class="col-md-6">
                      {{ form_row(form.newVehicle.dateImmatriculation) }}
                    </div>

                    <div class="col-md-6">
                      {{ form_row(form.newVehicle.couleur) }}
                    </div>

                    <div class="col-md-6">
                      {{ form_row(form.newVehicle.type) }}
                    </div>

                    <div class="col-md-6">
                      {{ form_row(form.newVehicle.places) }}
                    </div>

                  </div>

                  <small class="text-muted d-block mt-3">
                    Si ce formulaire est rempli, le v√©hicule sera automatiquement enregistr√© sur ton compte.
                  </small>

                </div>
              </div>
            </div>

            {# places dispo #}
            <div class="col-md-6">
              <label class="form-label fw-semibold">Places disponibles</label>
              <div class="places-grid">
                {{ form_widget(form.placesDisponibles) }}
              </div>
              {{ form_errors(form.placesDisponibles) }}
            </div>

            <div class="col-md-6">
              {{ form_row(form.tokenCost, {
                label: 'Co√ªt du trajet (tokens)',
                help: 'Entre 1 et 15 tokens (frais plateforme : +2 tokens √† la r√©servation).'
              }) }}
            </div>

            <div class="col-12">
              {{ form_row(form.commentaire) }}
            </div>

          </div>

          <div class="alert alert-info mt-3">
            üí° Le passager paiera <strong>(co√ªt du trajet + 2 tokens de frais plateforme)</strong> au moment de la r√©servation.
          </div>

          <div class="alert alert-info mt-3">
            üí° En proposant un trajet, vous serez √©galement d√©bit√© de <strong>2 tokens</strong> de frais plateforme.
          </div>

          <div class="text-center mt-3">
            <button type="submit" class="btn btn-ecoride w-100 rounded-pill py-2">
              Publier mon trajet
            </button>
          </div>

          {{ form_end(form) }}

        </div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const selectVehicle = document.querySelector('[name$="[vehicle]"]');
    const collapseEl = document.getElementById('collapseNewVehicle');
    const btn = document.getElementById('btnNewVehicle');

    if (!selectVehicle || !collapseEl || !btn) return;

    function sync() {
      // Si un v√©hicule existant est choisi -> on ferme le collapse + on d√©sactive le bouton
      if (selectVehicle.value) {
        collapseEl.classList.remove('show');
        btn.setAttribute('disabled', 'disabled');
        btn.classList.add('disabled');
      } else {
        btn.removeAttribute('disabled');
        btn.classList.remove('disabled');
      }
    }

    sync();
    selectVehicle.addEventListener('change', sync);
  });
</script>

{% endblock %}
