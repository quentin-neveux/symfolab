{% extends 'base.html.twig' %}

{% block title %}Détail du trajet - EcoRide{% endblock %}

{% block body %}
<section class="hero-section hero-recherche d-flex align-items-center text-center text-white position-relative">
  <div class="container">
    <h2 class="hero-title text-white mb-3">Détail du trajet</h2>
    <p class="hero-tagline mb-4">Consulte toutes les informations avant de réserver</p>
  </div>
</section>

<section class="section-trajet-detail py-5 bg-light">
  <div class="container">
    <div class="card card-trajet-detail shadow-lg border-0 rounded-4 p-4">

      <div class="row align-items-center flex-column flex-md-row g-4">

        <!-- Bloc gauche : infos trajet -->
        <div class="col-md-7 trajet-info">
          <h4 class="text-success fw-bold mb-3">
            {{ trajet.villeDepart }} → {{ trajet.villeArrivee }}
          </h4>
          <p><i class="bi bi-calendar"></i> {{ trajet.dateDepart|date('d/m/Y') }}</p>
          <p><i class="bi bi-clock"></i> {{ trajet.dateDepart|date('H:i') }}</p>
          <p><i class="bi bi-people"></i> {{ trajet.placesDisponibles }} place(s)</p>
          <p><i class="bi bi-cash"></i> {{ trajet.prix }} € / pers</p>

          {% if trajet.typeVehicule %}
            <p class="small text-muted">{{ trajet.typeVehicule }} • {{ trajet.energie }}</p>
          {% endif %}
          {% if trajet.commentaire %}
            <p class="fst-italic text-secondary mt-3">{{ trajet.commentaire }}</p>
          {% endif %}
        </div>

        <!-- Bloc droit : conducteur + paiement -->
        <div class="col-md-5 conducteur-info text-center text-md-start">
          <h5 class="text-success fw-bold mb-3">Détail du conducteur</h5>

          {% if trajet.conducteur %}
            <p><i class="bi bi-person-circle"></i> {{ trajet.conducteur.prenom }} {{ trajet.conducteur.nom }}</p>

            {% if trajet.conducteur.telephone %}
              {% set tel = trajet.conducteur.telephone|trim %}
              {% set prefix_len = tel|length > 8 ? (tel|length > 10 ? 3 : 2) : 0 %}
              {% set prefix = prefix_len ? tel|slice(0, prefix_len) : '' %}

              <div class="phone-mask" role="group" aria-label="Téléphone du conducteur">
                <button type="button" class="phone-mask__btn" data-phone="{{ tel }}" aria-expanded="false">
                  <i class="bi bi-telephone"></i>
                  <span class="phone-mask__visible">{{ prefix }}</span>
                  <span class="phone-mask__squares" aria-hidden="true">
                    {% for i in 1..8 %}
                      <span class="phone-mask__square"></span>
                    {% endfor %}
                  </span>
                  <span class="phone-mask__text">numéro de téléphone renseigné et validé</span>
                </button>
              </div>
            {% else %}
              <p class="text-muted fst-italic">Aucun numéro de téléphone renseigné.</p>
            {% endif %}

          {% else %}
            <p class="text-muted">Conducteur non renseigné.</p>
          {% endif %}

          <h5 class="text-success fw-bold mt-4">Procéder au paiement</h5>

          {% if app.user %}
            <a href="#" class="btn btn-ecoride w-100 mt-2">Payer et réserver</a>
          {% else %}
            <div class="d-grid gap-2 mt-3">
              <a href="{{ path('app_connexion') }}" class="btn btn-ecoride">Se connecter</a>
              <a href="#" class="btn btn-ecoride-outline">Réserver en invité</a>
            </div>
          {% endif %}
        </div>

      </div>
    </div>
  </div>
</section>
{% endblock %}
